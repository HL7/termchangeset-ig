<div xmlns="http://www.w3.org/1999/xhtml" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://hl7.org/fhir ../../input-cache/schemas/R5/fhir-single.xsd">
<a name="Export"> </a>
<h3>Export Protobuf Messages</h3>
<p>
To Export Protobuf Messages into Tinkar Data it's important to get the associated public_id's correct. 
It can cause issues if you are sending a message referencing a public_id for a FieldDefinition's data 
type component but end up referencing a public_id associated to a StampChronology. There needs to be 
a way to correlate public_id's from the sending and receiving systems. 
</p>
<p>
We should export STAMPChornology messages first, ConceptChronology messages second, PatternChronology 
messages third, and SemanticChronology messages last. We should be exporting/importing in this order 
to make sure we are not missing any data. 
</p>
<a name="Use Case 1"> </a>
<h4>Use Case 1: Changing a SNOMED Concept's Semantic Value </h4>
<p>
In this case we want to simulate a change for a SNOMED Concept's value. 
As SNOMED is updated with new versions, new rules and Axiom Definitions are assigned to concepts. 
In this use case we will simulate an update to Chronic Lung Disease on the United Stated Edition 
from the 2020-09-01 version to the 2021-03-01 version. 
</p>
<p>
Figure 1: The 2020-09-01 Version of Chronic Lung Disease 
</p>
<p>
<div>
  <img src="20200901chroniclungdisease.png" alt="2020 Chronic Lung Disease"/>
</div>
</p>
<p>
Figure 2: The 2021-03-01 Version of Chronic Lung Disease 
</p>
<p>
<div>
<img src="20210301chroniclungdisease.png" alt="2021 Chronic Lung Disease"/>
</div>
</p>
<a name="Use Case 1 Message 1"> </a>
<h5>Message 1: Creating a new Tinkar STAMP Coordinate</h5>
<p>
This message model create a new STAMP Coordinate and assigns the values to the Public ID's 
and the protobuf timestamp. An issue could occur if the receiver of the message doesn't have 
the necessary concepts and public ID's that the message is sending. For example, a recipient 
might not have the unique Author Public ID in certain cases. If this is the case the specific 
author coordinate would have to be sent as a TinkarMsg with Primordial Modules + Paths first. 
</p>
  <div class="box">
    <pre>
      <code class="language-java linenumbers">
message TinkarMsg { 
  StampChronology { 
    PublicId public_id = "NEW STAMP CHRONOLOGY Public ID"; 

    // The stamp version. 
    StampVersion first_stamp_version =  StampVersion { 
      // Status of the item this STAMP references.
      PublicId status_public_id = "Active Status Public ID"; 

      // Author of the item this STAMP references. 
      PublicId author_public_id = "SNOMED CT Author Public ID"; 

      // Module of the item this STAMP references. 
      PublicId module_public_id = "SNOMED CT US EDITION Public ID"; 

      // Path of the item this STAMP references. 
      PublicId path_public_id = "Development Path Public ID"; 

      // Creation time of the item this STAMP references. 
      google.protobuf.Timestamp time = "Current Date/Time";// Or if we wanted to simulate the update this would be the 2021-03-01 Timestamp 
    };         
  } 
} 
      </code>
    </pre>
  </div>

<a name="Use Case 1 Message 2"> </a>
<h5>Message 2: Assigning the new SNOMED CT Axiom Definition</h5>
<p>
Next we need to assign values and semantics to the newly created concept. 
In this example protobuf message we assign a new example Axiom Definition 
using the Axiom Definition Pattern. Axiom Definition Pattern has one FieldDefinition, 
string_public_id (String of Axiom Definition) 
</p>
  <div class="box">
      <pre>
        <code class="language-java linenumbers">
message TinkarMsg { 
  SemanticChronology { 
    // Unique Public id of this semantic chronology. 
    PublicId public_id = "New Axiom Definition Semantic Chronology Public ID"; 

    // ID of Concept that this semantic references. 
    PublicId referenced_component_public_id = "Chronic Lung Disease Public ID"; 

    // ID of Pattern that defines the allowable fields in this semantic. 
    PublicId pattern_for_semantic_public_id = "Axiom Definition Pattern Public ID"; 

    // List of versions of this semantic. 
    repeated SemanticVersion semantic_versions = [ 
      // Thew New Semantic version 
      SemanticVersion { 
        // STAMP chronology public ID for this version. (Message 1) 
        PublicId stamp_chronology_public_id = "NEW STAMP CHRONOLOGY Public ID"; 

        // Fields for this semantic. Each field defined is defined by 
        // a matching entry in the pattern field definition list. 
        repeated Field fields = [ 
          Field { 
            string string_value = " EquivalentClasses( 
              :413839001 |Chronic lung disease (disorder)| 
              ObjectIntersectionOf( 
                :64572001 |Disease (disorder)| 
                ObjectSomeValuesFrom( 
                  :609096000 |Role group (attribute)| 
                  ObjectSomeValuesFrom( 
                    :263502005 |Clinical course (attribute)| 
                    :90734009 |Chronic (qualifier value)| 
                  ) 
                ) 
                ObjectSomeValuesFrom( 
                  :609096000 |Role group (attribute)| 
                  ObjectSomeValuesFrom( 
                    :363698007 |Finding site (attribute)| 
                    :39607008 |Lung structure (body structure)| 
                  ) 
                ) 
              ) 
            ) "; 
          } 
        ]; 
      }, 

      // Then you can re-use all previously assigned version values since the version is repeatable 
      SemanticVersion { 
        // STAMP chronology public ID for this OLDER version. 
        PublicId stamp_chronology_public_id = "OLDER STAMP CHRONOLOGY Public ID"; 

        // Fields for this semantic. Each field defined is defined by
        // a matching entry in the pattern field definition list. 
        repeated Field fields = [ 
          Field { 
            string string_value = " SubClassOf( 
              :413839001 |Chronic lung disease (disorder)| 
              ObjectIntersectionOf( 
                :17097001 |Chronic disease of respiratory system (disorder)| 
                ObjectSomeValuesFrom( 
                  :609096000 |Role group (attribute)| 
                  ObjectSomeValuesFrom( 
                    :363698007 |Finding site (attribute)| 
                    :39607008 |Lung structure (body structure)| 
                  ) 
                ) 
              ) 
            ) "; 
          } 
        ] 
      }; 
    ]; 
  } 
} 
      </code>
    </pre>
  </div>
</div>
